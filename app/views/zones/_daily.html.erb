<div class="flex flex-col items-center justify-center text-base-content z-0 text-center w-full my-auto px-4 md:px-8 lg:px-12 py-8 md:pt-16"
     data-controller="prayer-times"
     data-prayer-times-zone-value="<%= @zone %>"
     data-prayer-times-prayers-value="{}">

  <!-- Main Clock & Date Section -->
  <div class="mb-6">
    <!-- Large Clock -->
    <div class="text-6xl md:text-7xl lg:text-8xl font-black tabular-nums tracking-tight leading-none" data-controller="clock" data-clock-mode="hero"></div>

    <!-- Date Display with Navigation -->
    <div class="mt-4 flex items-center justify-center gap-4">
      <!-- Previous Day Button -->
      <button type="button"
              class="p-2 rounded-full backdrop-blur-md bg-white/10 border border-white/20 hover:bg-white/20 transition-all"
              data-action="click->prayer-times#previousDay"
              data-prayer-times-target="prevButton"
              aria-label="Hari sebelumnya">
        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"/>
        </svg>
      </button>

      <!-- Date Display -->
      <div class="flex flex-col items-center gap-1">
        <div class="text-xl md:text-2xl lg:text-3xl font-medium text-base-content/80" data-prayer-times-target="dateDisplay">
          <%= l Date.current, format: :extra %>
        </div>
        <div class="text-lg md:text-xl text-primary font-semibold" data-prayer-times-target="hijriDisplay">
          <%= hijri_date(Date.current.strftime("%Y-%m-%d")) %> H
        </div>
      </div>

      <!-- Next Day Button -->
      <button type="button"
              class="p-2 rounded-full backdrop-blur-md bg-white/10 border border-white/20 hover:bg-white/20 transition-all"
              data-action="click->prayer-times#nextDay"
              data-prayer-times-target="nextButton"
              aria-label="Hari seterusnya">
        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5"/>
        </svg>
      </button>
    </div>

    <!-- Location Badge -->
    <label class="inline-flex items-center gap-2 cursor-pointer mt-4 backdrop-blur-md bg-white/10 rounded-full px-5 py-2.5 border border-white/20 hover:bg-white/20 transition-all" for="filter-modal">
      <svg class="w-4 h-4 opacity-70" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"/>
      </svg>
      <span class="text-sm font-semibold"><%= @location["location"] %></span>
      <svg class="w-4 h-4 opacity-50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5"/>
      </svg>
    </label>
  </div>

  <!-- Prayer Cards Carousel -->
  <div class="w-full max-w-2xl mb-8">
    <div class="carousel w-full" data-prayer-times-target="carousel">
      <!-- Slide 1: Next Prayer Card -->
      <div id="slide-prayer" class="carousel-item w-full">
        <div class="backdrop-blur-md bg-white/10 rounded-3xl p-6 border border-white/20 shadow-2xl w-full">
          <!-- Next Prayer Label -->
          <div class="flex items-center justify-center gap-2 mb-3">
            <div class="w-2 h-2 rounded-full bg-primary animate-pulse"></div>
            <span class="text-sm font-semibold text-base-content/70 uppercase tracking-wider" data-prayer-times-target="nextPrayer">Solat Seterusnya</span>
          </div>

          <!-- Countdown Timer -->
          <div class="text-4xl md:text-5xl font-black tabular-nums text-center text-primary" data-prayer-times-target="countdown">
            --:--:--
          </div>

          <!-- Progress Bar -->
          <div class="w-full bg-base-content/10 rounded-full h-1.5 mt-4 overflow-hidden">
            <div class="bg-primary h-full rounded-full transition-all duration-1000 ease-out" data-prayer-times-target="progressBar" style="width: 0%"></div>
          </div>

          <!-- Progress Text -->
          <div class="flex justify-between text-xs mt-2 text-base-content/50 font-medium">
            <span data-prayer-times-target="progressStart">--:--</span>
            <span data-prayer-times-target="progressEnd">--:--</span>
          </div>
        </div>
      </div>

      <!-- Slide 2: Waktu Puasa (Sahur/Berbuka) - Context switches based on time -->
      <div id="slide-puasa" class="carousel-item w-full">
        <div class="backdrop-blur-md bg-white/10 rounded-3xl p-6 border border-white/20 shadow-2xl w-full" data-prayer-times-target="puasaCard">
          <!-- Puasa Label (switches between Sahur/Berbuka) -->
          <div class="flex items-center justify-center gap-2 mb-3">
            <!-- Sahur Icon (Moon) -->
            <svg class="w-5 h-5 text-info hidden" data-prayer-times-target="sahurIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"/>
            </svg>
            <!-- Berbuka Icon (Sun) -->
            <svg class="w-5 h-5 text-warning hidden" data-prayer-times-target="berbukaIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"/>
            </svg>
            <span class="text-sm font-semibold text-base-content/70 uppercase tracking-wider" data-prayer-times-target="puasaLabel">Waktu Puasa</span>
          </div>

          <!-- Puasa Countdown Timer -->
          <div class="text-4xl md:text-5xl font-black tabular-nums text-center" data-prayer-times-target="puasaCountdown">
            --:--:--
          </div>

          <!-- Puasa Time Display -->
          <div class="text-center mt-2 text-base-content/60" data-prayer-times-target="puasaTimeLabel">
            <span data-prayer-times-target="puasaTimePrefix">--</span> <span class="font-semibold text-base-content" data-prayer-times-target="puasaTime">--:--</span>
          </div>

          <!-- Puasa Progress Bar -->
          <div class="w-full bg-base-content/10 rounded-full h-1.5 mt-4 overflow-hidden">
            <div class="h-full rounded-full transition-all duration-1000 ease-out" data-prayer-times-target="puasaProgressBar" style="width: 0%"></div>
          </div>

          <!-- Puasa Progress Text -->
          <div class="flex justify-between text-xs mt-2 text-base-content/50 font-medium">
            <span data-prayer-times-target="puasaProgressStart">--:--</span>
            <span data-prayer-times-target="puasaProgressEnd">--:--</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Carousel Indicators -->
    <div class="flex w-full justify-center gap-2 py-4">
      <a href="#slide-prayer" data-turbo="false" class="btn btn-xs btn-circle backdrop-blur-md bg-white/10 border border-white/20 hover:bg-primary hover:border-primary transition-all" data-prayer-times-target="indicatorPrayer">
        <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
        </svg>
      </a>
      <a href="#slide-puasa" data-turbo="false" class="btn btn-xs btn-circle backdrop-blur-md bg-white/10 border border-white/20 hover:bg-white/20 transition-all" data-prayer-times-target="indicatorPuasa">
        <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8.25v-1.5m0 1.5c-1.355 0-2.697.056-4.024.166C6.845 8.51 6 9.473 6 10.608v2.513m6-4.871c1.355 0 2.697.056 4.024.166C17.155 8.51 18 9.473 18 10.608v2.513M15 8.25v-1.5m-6 1.5v-1.5m12 9.75-1.5.75a3.354 3.354 0 0 1-3 0 3.354 3.354 0 0 0-3 0 3.354 3.354 0 0 1-3 0 3.354 3.354 0 0 0-3 0 3.354 3.354 0 0 1-3 0L3 16.5m15-3.379a48.474 48.474 0 0 0-6-.371c-2.032 0-4.034.126-6 .371m12 0c.39.049.777.102 1.163.16 1.07.16 1.837 1.094 1.837 2.175v5.169c0 .621-.504 1.125-1.125 1.125H4.125A1.125 1.125 0 0 1 3 20.625v-5.17c0-1.08.768-2.014 1.837-2.174A47.78 47.78 0 0 1 6 13.12M12.265 3.11a.375.375 0 1 1-.53 0L12 2.845l.265.265Zm-3 0a.375.375 0 1 1-.53 0L9 2.845l.265.265Zm6 0a.375.375 0 1 1-.53 0L15 2.845l.265.265Z"/>
        </svg>
      </a>
    </div>
  </div>

  <!-- Prayer Times Grid - 2 rows x 4 columns -->
  <div class="w-full max-w-2xl">
    <div class="grid grid-cols-4 gap-3 md:gap-4" data-prayer-times-target="prayerGrid">
      <!-- Loading skeleton -->
      <% 8.times do %>
        <div class="backdrop-blur-md bg-white/10 rounded-2xl p-4 md:p-5 border border-white/10 animate-pulse">
          <div class="h-3 w-12 bg-base-content/20 rounded mb-2"></div>
          <div class="h-8 w-16 bg-base-content/20 rounded mb-1"></div>
          <div class="h-2 w-8 bg-base-content/20 rounded"></div>
        </div>
      <% end %>
    </div>
  </div>
</div>
